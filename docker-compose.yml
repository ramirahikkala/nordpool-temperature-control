volumes:
  app_data:

services:
  temperature-controller:
    build: .
    container_name: ha-temperature-controller
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - TZ=Europe/Helsinki
    command: uv run python main.py
    volumes:
      - app_data:/app/data
  
  web-dashboard:
    build: .
    container_name: ha-temperature-web
    restart: unless-stopped
    env_file:
      - .env
    environment:
      - TZ=Europe/Helsinki
      - WEB_PORT=5000
      - PYTHONPATH=/app
    networks:
      - caddy-proxy
    working_dir: /app
    volumes:
      - app_data:/app/data
    command: sh -c ". /app/.venv/bin/activate && gunicorn -w 2 -b 0.0.0.0:5000 --timeout 120 web_app:app"

networks:
  caddy-proxy:
    external: true
